# PART 2: CONTINUATION OF REVOCATION SOP

## 2.2. Διαδικτυακή Πύλη (Web Portal) - Συνέχεια

#### 2.2.2. Διαδικασία Ανάκλησης (συνέχεια)

4. Επιλογή **λόγου ανάκλησης** από dropdown:
   - 🔑 **Διαρροή κλειδιού / Χάθηκε η συσκευή** (keyCompromise - RFC 5280 reason code 1)
   - 🏢 **Αλλαγή εργασίας / Αποχώρηση** (affiliationChanged - reason code 3)
   - 🔄 **Αντικατάσταση πιστοποιητικού** (superseded - reason code 4)
   - ⏹️ **Παύση χρήσης** (cessationOfOperation - reason code 5)
   - 📋 **Άλλο** (unspecified - reason code 0)

5. **Επιβεβαίωση αιτήματος:**
   - Εμφανίζεται παράθυρο επιβεβαίωσης:
     > "⚠️ ΠΡΟΕΙΔΟΠΟΙΗΣΗ: Η ανάκληση είναι ΜΟΝΙΜΗ και ΔΕΝ μπορεί να αναιρεθεί. Μετά την ανάκληση, δεν θα μπορείτε να χρησιμοποιήσετε αυτό το πιστοποιητικό ξανά. Είστε σίγουροι;"
   - Ο συνδρομητής πληκτρολογεί **"ΕΠΙΒΕΒΑΙΩΝΩ"** (CAPTCHA για αποφυγή automation attacks)
   - Κλικ στο κουμπί **"Οριστική Ανάκληση"**

6. **Άμεση επεξεργασία:**
   - Το σύστημα καταχωρεί την ανάκληση αμέσως στη βάση δεδομένων
   - Ticket ID δημιουργείται αυτόματα
   - Timestamp (UTC) καταγράφεται με ακρίβεια millisecond

7. **Επιβεβαίωση:**
   - Εμφανίζεται μήνυμα επιτυχίας στην οθόνη με το Ticket ID
   - Αποστέλλεται αυτόματα:
     - 📧 **Email** επιβεβαίωσης στη διεύθυνση εγγραφής
     - 📱 **SMS** στον εγγεγραμμένο αριθμό κινητού
   - Περιεχόμενο: *"Το πιστοποιητικό σας [SERIAL] ανακλήθηκε επιτυχώς στις [TIMESTAMP] UTC. Ticket ID: [ID]. Η ανάκληση θα εμφανιστεί στο OCSP εντός 15 λεπτών."*

#### 2.2.3. Ασφάλεια Web Portal

- **Rate Limiting:** Μέγιστο 5 αιτήματα ανάκλησης ανά λογαριασμό ανά ώρα (αποτροπή brute force / mass revocation attacks)
- **Session Management:** Αυτόματη αποσύνδεση μετά από 15 λεπτά αδράνειας
- **Audit Logging:** Κάθε ενέργεια καταγράφεται (IP address, user agent, timestamp, action)
- **WAF Protection:** Web Application Firewall με κανόνες OWASP Top 10
- **TLS Pinning:** Προστασία από MitM attacks

---

### 2.3. Ηλεκτρονικό Ταχυδρομείο (Email)

#### 2.3.1. Στοιχεία Επικοινωνίας

- **Διεύθυνση:** **[REVOCATION_EMAIL]**
- **Αποδοχή:** 24×7 (αυτόματη επεξεργασία εισερχόμενων email)
- **Χρόνος απόκρισης:** Αυτόματη απάντηση εντός 1 λεπτού

#### 2.3.2. Απαιτήσεις Αίτησης

**🔐 ΑΠΑΙΤΕΙΤΑΙ ΨΗΦΙΑΚΗ ΥΠΟΓΡΑΦΗ:**

Το αίτημα ανάκλησης μέσω email **πρέπει** να είναι ψηφιακά υπογεγραμμένο με:
- Ένα **άλλο έγκυρο πιστοποιητικό** του ίδιου συνδρομητή (όχι το πιστοποιητικό προς ανάκληση), ή
- Το **ίδιο πιστοποιητικό** (αποδεκτό μόνο αν ο λόγος είναι superseded ή cessationOfOperation, **όχι** keyCompromise)

**Μορφή Αίτησης (Template):**

```
Προς: [REVOCATION_EMAIL]
Θέμα: Αίτηση Ανάκλησης Πιστοποιητικού

Ονοματεπώνυμο: [Όνομα συνδρομητή]
Email Εγγραφής: [Email]
Σειριακός Αριθμός Πιστοποιητικού: 0x[HEX_SERIAL]
Λόγος Ανάκλησης: [keyCompromise / affiliationChanged / superseded / cessationOfOperation / unspecified]

Αιτιολογία: [Περιγραφή λόγου]

Επισυνάπτω την ταυτότητά μου και επιβεβαιώνω ότι ζητώ την άμεση ανάκληση του παραπάνω πιστοποιητικού.

Υπογραφή: [Ψηφιακή υπογραφή S/MIME ή PAdES]
Ημερομηνία: [ISO 8601 format]
```

#### 2.3.3. Αυτόματη Επεξεργασία

1. **Έλεγχος Υπογραφής:**
   - Το σύστημα επαληθεύει αυτόματα την ψηφιακή υπογραφή
   - ✅ **Έγκυρη υπογραφή:** Συνέχεια στο βήμα 2
   - ❌ **Άκυρη ή μη υπάρχουσα υπογραφή:** Αυτόματη απόρριψη + αποστολή email:
     > "Το αίτημά σας για ανάκληση δεν μπορεί να γίνει αποδεκτό επειδή δεν είναι ψηφιακά υπογεγραμμένο. Για λόγους ασφαλείας, απαιτείται ψηφιακή υπογραφή με έγκυρο πιστοποιητικό. Παρακαλούμε χρησιμοποιήστε την τηλεφωνική γραμμή [REVOCATION_HOTLINE] ή την διαδικτυακή πύλη για άμεση ανάκληση."

2. **Επαλήθευση Συνδρομητή:**
   - Το σύστημα ελέγχει αν το email του υπογράφοντα ταιριάζει με το email εγγραφής του πιστοποιητικού προς ανάκληση
   - Έλεγχος αν το Subject DN του υπογράφοντος πιστοποιητικού ταιριάζει με το DN του πιστοποιητικού προς ανάκληση

3. **Δημιουργία Ticket:**
   - Αυτόματη δημιουργία revocation ticket
   - Αποστολή επιβεβαίωσης: *"Λάβαμε το αίτημά σας. Ticket ID: [ID]. Η ανάκληση θα ολοκληρωθεί εντός 1 ώρας."*

4. **Manual Review (Προαιρετικό):**
   - Εάν το σύστημα εντοπίσει ανωμαλίες (π.χ. διαφορετικό όνομα στο Subject), το ticket κλιμακώνεται σε RA Operator για χειροκίνητη επαλήθευση

#### 2.3.4. Περιορισμοί

- **Χρόνος επεξεργασίας:** Μέγιστο **1 ώρα** (συνήθως 15-30 λεπτά)
- **Μέγεθος email:** Μέγιστο 10 MB (για επισυναπτόμενα)
- **Rate limiting:** Μέγιστο 3 αιτήματα ανά email address ανά ώρα

---

### 2.4. Αυτοπρόσωπη Παρουσία (In-Person Revocation)

#### 2.4.1. Τοποθεσίες

Ο συνδρομητής μπορεί να επισκεφθεί τα **εξουσιοδοτημένα γραφεία της Αρχής Εγγραφής (RA)**:

- **Κεντρικά Γραφεία Αθήνας:** [ADDRESS_ATHENS]
  - Ώρες λειτουργίας: Δευτέρα-Παρασκευή, 09:00-17:00 EET/EEST
  - Επικοινωνία: [PHONE_ATHENS]

- **Παράρτημα Θεσσαλονίκης:** [ADDRESS_THESSALONIKI]
  - Ώρες λειτουργίας: Δευτέρα-Παρασκευή, 09:00-17:00 EET/EEST
  - Επικοινωνία: [PHONE_THESSALONIKI]

- **[Άλλες τοποθεσίες, αν υπάρχουν]**

#### 2.4.2. Διαδικασία

1. **Επίδειξη Ταυτότητας:**
   - Ο συνδρομητής επιδεικνύει **επίσημο έγγραφο ταυτοποίησης**:
     - Ελληνική Αστυνομική Ταυτότητα (εν ισχύ)
     - Διαβατήριο (εν ισχύ)
     - Άδεια οδήγησης (εν ισχύ)
     - Για νομικά πρόσωπα: Εξουσιοδότηση + ταυτότητα εξουσιοδοτημένου εκπροσώπου

2. **Συμπλήρωση Εντύπου:**
   - Ο RA Operator παρέχει το έντυπο **"Αίτηση Ανάκλησης Πιστοποιητικού"** (Form 11-REV)
   - Ο συνδρομητής συμπληρώνει:
     - Ονοματεπώνυμο
     - Σειριακός αριθμός πιστοποιητικού (ή αναζήτηση με email)
     - Λόγος ανάκλησης
     - Υπογραφή (χειρόγραφη)

3. **Επαλήθευση από RA Operator:**
   - Ο RA Operator συγκρίνει τη φωτογραφία στο έγγραφο ταυτοποίησης με το άτομο
   - Επαληθεύει ότι το όνομα στην ταυτότητα ταιριάζει με το όνομα στο πιστοποιητικό
   - Φωτοαντίγραφο (ή scan) του εγγράφου ταυτοποίησης επισυνάπτεται στο ticket

4. **Άμεση Εκτέλεση:**
   - Ο RA Operator εισάγει την ανάκληση στο σύστημα **αμέσως** (παρουσία του συνδρομητή)
   - Ο συνδρομητής λαμβάνει **έντυπη απόδειξη** με το Ticket ID και την ώρα ανάκλησης

5. **Αρχειοθέτηση:**
   - Το έντυπο και το αντίγραφο ταυτότητας αρχειοθετούνται φυσικά και ηλεκτρονικά (scan) για 7 έτη

#### 2.4.3. Πλεονεκτήματα

- **Υψηλότερη ασφάλεια:** Καμία πιθανότητα κοινωνικής μηχανικής (φυσική επαλήθευση προσώπου)
- **Άμεση επιβεβαίωση:** Ο συνδρομητής βλέπει την ανάκληση να εκτελείται
- **Νομική ισχύς:** Η χειρόγραφη υπογραφή και το φυσικό έγγραφο παρέχουν ισχυρή απόδειξη

---

## 3. ΔΙΑΔΙΚΑΣΙΕΣ ΕΠΕΞΕΡΓΑΣΙΑΣ ΑΝΑΚΛΗΣΗΣ

### 3.1. Χρόνος Επεξεργασίας (SLA)

**Κανονιστική Απαίτηση:** Άρθρο 11.3 ΕΕΤΤ Κανονισμού, Άρθρο 24(2)(h) eIDAS

| Μέθοδος Αποδοχής | Στόχος (Target) | Μέγιστος Χρόνος (Maximum) | Κανονιστικό Όριο |
|------------------|-----------------|---------------------------|------------------|
| **Τηλεφωνική Γραμμή** | 5 λεπτά | 15 λεπτά | 24 ώρες (eIDAS) |
| **Web Portal** | Άμεσα (< 1 λεπτό) | 5 λεπτά | 24 ώρες (eIDAS) |
| **Email** | 15 λεπτά | 1 ώρα | 24 ώρες (eIDAS) |
| **Αυτοπρόσωπη** | Άμεσα (παρουσία συνδρομητή) | 5 λεπτά | 24 ώρες (eIDAS) |

**Ορισμός "Επεξεργασία":**
- **Έναρξη:** Χρόνος που το έγκυρο αίτημα γίνεται αποδεκτό από το σύστημα
- **Ολοκλήρωση:** Χρόνος που η κατάσταση "revoked" αντικατοπτρίζεται στο OCSP responder

**Μέτρηση:**
- Αυτόματη μέτρηση για κάθε revocation ticket: `Time_OCSP_Updated - Time_Request_Received`
- Μηνιαία αναφορά SLA compliance: % των αιτημάτων που πληρούν τον στόχο

### 3.2. Βήματα Επεξεργασίας (Detailed Process Flow)

#### **ΒΗΜΑ 1: Άμεση Αποδοχή & Καταγραφή**

**Τι συμβαίνει:**
- Κάθε αίτημα (από οποιοδήποτε κανάλι) λαμβάνει **αμέσως** ένα μοναδικό αναγνωριστικό:
  - **Format:** `REV-YYYYMMDD-NNNN` (π.χ. REV-20250115-0042)
- Το ticket καταχωρείται στο **ITSM (IT Service Management) σύστημα** με:
  - Timestamp (UTC, precision: millisecond)
  - Κανάλι αποδοχής (Phone / Web / Email / In-person)
  - Στοιχεία αιτούντος (pseudonymized για GDPR compliance)
  - Serial number πιστοποιητικού
  - Λόγος ανάκλησης (reason code)
  - Κατάσταση: **"PENDING_AUTHENTICATION"**

**Υπεύθυνος:** NOC/SOC Operator (για τηλεφωνικά), Αυτόματο σύστημα (για Web/Email)

**Χρόνος:** < 10 δευτερόλεπτα

---

#### **ΒΗΜΑ 2: Επικύρωση Αιτούντος**

**Τι συμβαίνει:**
- Ο χειριστής (ή το αυτόματο σύστημα) **επικυρώνει την ταυτότητα** του αιτούντος σύμφωνα με τις διαδικασίες της Ενότητας 2:
  - Τηλέφωνο: Μέθοδος A, B, ή C (§2.1.2)
  - Web: 2FA login (§2.2)
  - Email: Ψηφιακή υπογραφή (§2.3)
  - In-person: Επίδειξη ταυτότητας (§2.4)

**Αποτέλεσμα:**
- ✅ **Επιτυχής επικύρωση:** Κατάσταση ticket → **"AUTHENTICATED"** → Συνέχεια στο Βήμα 3
- ❌ **Αποτυχία επικύρωσης:** Κατάσταση ticket → **"AUTHENTICATION_FAILED"**
  - Αποστολή ειδοποίησης στον αιτούντα (εάν διαθέσιμο email/phone)
  - Ticket κλείνει χωρίς εκτέλεση ανάκλησης
  - **Ειδοποίηση πραγματικού συνδρομητή** (αν υπάρχει υποψία απάτης)

**Υπεύθυνος:** RA Operator, NOC Operator, ή Αυτόματο σύστημα

**Χρόνος:** 2-10 λεπτά (τηλέφωνο), < 1 λεπτό (Web/Email), 5 λεπτά (in-person)

---

#### **ΒΗΜΑ 3: Εκτέλεση Ανάκλησης**

**🔐 ΚΡΙΣΙΜΗ ΛΕΙΤΟΥΡΓΙΑ - ΑΠΑΙΤΕΙ ΠΡΟΝΟΜΙΑ CA ADMINISTRATOR**

**Τι συμβαίνει:**

1. **Έγκριση από CA Administrator:**
   - Ο εξουσιοδοτημένος **CA Administrator** (ή αυτοματοποιημένο σύστημα με ασφαλείς πολιτικές) εγκρίνει την ανάκληση
   - **Dual control** για high-value certificates: 2 CA Administrators πρέπει να εγκρίνουν (4-eyes principle)

2. **Ενημέρωση CA Database:**
   - Το σύστημα ενημερώνει τη **βάση δεδομένων της CA** (Certificate Authority Database):
     ```sql
     UPDATE certificates
     SET status = 'revoked',
         revocation_reason = [REASON_CODE],
         revocation_timestamp = [UTC_TIMESTAMP],
         revoked_by_operator = [OPERATOR_ID]
     WHERE serial_number = [CERT_SERIAL]
     ```
   - **Atomic transaction:** Η ενημέρωση είναι atomic και logged (δεν μπορεί να διακοπεί στη μέση)

3. **Καταχώρηση Reason Code:**
   Σύμφωνα με **RFC 5280, §5.3.1**, οι κωδικοί λόγων ανάκλησης είναι:

   | Code | CRLReason | Περιγραφή (Ελληνικά) | Χρήση |
   |------|-----------|---------------------|-------|
   | 0 | unspecified | Μη καθορισμένος λόγος | Γενική ανάκληση χωρίς συγκεκριμένο λόγο |
   | 1 | keyCompromise | Διαρροή ιδιωτικού κλειδιού | **Κρίσιμο:** Το κλειδί έχει διαρρεύσει ή υποπτεύεται διαρροή |
   | 2 | cACompromise | Διαρροή κλειδιού CA | **Έκτακτο:** Χρησιμοποιείται μόνο για CA key compromise (§7.1) |
   | 3 | affiliationChanged | Αλλαγή σχέσης | Ο συνδρομητής άλλαξε εργοδότη, ρόλο, ή οργανισμό |
   | 4 | superseded | Αντικαταστάθηκε | Νέο πιστοποιητικό εκδόθηκε για τον ίδιο συνδρομητή |
   | 5 | cessationOfOperation | Παύση λειτουργίας | Ο συνδρομητής παύει να χρησιμοποιεί ψηφιακές υπογραφές |
   | 6 | certificateHold | Αναστολή (προσωρινή) | **Μόνο για CRL** - OCSP επιστρέφει "revoked" (§4) |
   | 8 | removeFromCRL | Αφαίρεση από CRL | Επαναφορά από αναστολή (§4.2) |
   | 9 | privilegeWithdrawn | Ανάκληση προνομίου | Το δικαίωμα χρήσης πιστοποιητικού αφαιρέθηκε |
   | 10 | aACompromise | Διαρροή Attribute Authority | Σπάνια χρήση |

4. **Timestamp (Χρονοσήμανση):**
   - Η ακριβής ώρα ανάκλησης καταγράφεται σε **UTC με ακρίβεια millisecond**
   - Format: `YYYY-MM-DDTHH:MM:SS.sssZ` (ISO 8601)
   - Παράδειγμα: `2025-01-15T14:23:47.382Z`
   - **Σημασία:** Αυτή η χρονοσήμανση καθορίζει από πότε το πιστοποιητικό θεωρείται άκυρο

5. **Audit Log:**
   - Η ενέργεια καταγράφεται σε **immutable audit log** (append-only, tamper-proof):
     ```
     [2025-01-15T14:23:47.382Z] REVOCATION_EXECUTED
     Ticket: REV-20250115-0042
     Certificate: 0x3F2A1B9C4D5E6F7A
     Reason: keyCompromise (1)
     CA Admin: [OPERATOR_NAME] (ID: CA-ADM-007)
     Authentication Method: Phone (Secret Questions)
     ```

**Υπεύθυνος:** CA Administrator

**Χρόνος:** < 30 δευτερόλεπτα

---

#### **ΒΗΜΑ 4: Ενημέρωση Υπηρεσιών Κατάστασης**

**Τι συμβαίνει:**

1. **OCSP Cache Flush:**
   - Το σύστημα στέλνει **invalidation signal** σε όλους τους OCSP responders (τουλάχιστον 4 instances)
   - Οι OCSP responders **εκκαθαρίζουν (flush) το cache** για το συγκεκριμένο πιστοποιητικό
   - Η επόμενη OCSP request για αυτό το πιστοποιητικό θα επιστρέψει κατάσταση **"revoked"** με:
     - `revocationTime`: [UTC_TIMESTAMP]
     - `revocationReason`: [REASON_CODE]

2. **CRL Scheduling:**
   - Η ανάκληση **προγραμματίζεται** για συμπερίληψη στην επόμενη έκδοση:
     - **Delta CRL:** Εκδίδεται κάθε 1 ώρα → Η ανάκληση θα εμφανιστεί στην επόμενη Delta CRL (max 1 ώρα αναμονή)
     - **Full CRL:** Εκδίδεται κάθε 12 ώρες → Η ανάκληση θα εμφανιστεί στην επόμενη Full CRL (max 12 ώρες)
   - **Επείγον:** Για λόγο `cACompromise` (CA key compromise), εκδίδεται **άμεση έκτακτη CRL** (§7.1)

3. **Replication:**
   - Η ενημέρωση αναπαραγάγεται (replicate) σε όλα τα γεωγραφικά κατανεμημένα data centers:
     - Primary DC (Athens): < 1 δευτερόλεπτο
     - DR DC (Thessaloniki): < 5 δευτερόλεπτα
   - **Consistency check:** Αυτόματος έλεγχος ότι όλα τα replicas έχουν την ίδια κατάσταση

**Υπεύθυνος:** Αυτόματο σύστημα (Background Job)

**Χρόνος:** 
- OCSP: < 1 λεπτό (target), < 15 λεπτά (SLA)
- CRL: 1 ώρα (Delta), 12 ώρες (Full)

---

#### **ΒΗΜΑ 5: Ειδοποίηση Συνδρομητή**

**Τι συμβαίνει:**

Το σύστημα στέλνει **αυτόματες ειδοποιήσεις** στον συνδρομητή:

1. **Email Confirmation:**
   ```
   Θέμα: ✅ Επιβεβαίωση Ανάκλησης Πιστοποιητικού [CERT_SERIAL]
   
   Αγαπητέ/ή [SUBSCRIBER_NAME],
   
   Το πιστοποιητικό σας με σειριακό αριθμό 0x[CERT_SERIAL] ανακλήθηκε επιτυχώς.
   
   Στοιχεία Ανάκλησης:
   - Ticket ID: REV-20250115-0042
   - Ημερομηνία/Ώρα: 2025-01-15 14:23:47 UTC
   - Λόγος: Διαρροή κλειδιού (keyCompromise)
   - Κανάλι: Τηλεφωνική γραμμή
   
   Τι σημαίνει αυτό:
   - Το πιστο